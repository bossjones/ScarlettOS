# This file was autogenerated and will overwrite each time you run travis_pypi_setup.py
sudo: required
dist: xenial
language: python
group: edge

# source: https://github.com/Mousers/mousetrap-3.17/blob/c184167da0b6f03d75e9ba197ce80aa15bc72ad5/bin/ci-install-deps.bash
before_install:
  - export MAIN_DIR=$(pwd)
  # - export VIRT_ROOT=/home/travis/virtualenv/python$TRAVIS_PYTHON_VERSION
  # - export PKG_CONFIG_PATH=$VIRT_ROOT/lib/pkgconfig
  # - export SCARLETT_CONFIG=$MAIN_DIR/tests/fixtures/.scarlett
  # - export SCARLETT_HMM=$MAIN_DIR/tests/fixtures/model/hmm/en_US/hub4wsj_sc_8k
  # - export SCARLETT_LM=$MAIN_DIR/tests/fixtures/lm/1602.lm
  # - export SCARLETT_DICT=$MAIN_DIR/tests/fixtures/dict/1602.dic
  # - export PYTHONIOENCODING=UTF8
  - export GSTREAMER=1.0
  # - export PYTHON_VERSION=$(python -c "import sys; print('%s.%s' % sys.version_info[:2])")
  # - export PYTHON_INC_DIR=$(python -c "from distutils.sysconfig import get_python_inc; print(get_python_inc())")
  # - export PYTHON_SITE_PACKAGES=$(python -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")
  - ls -lta $PKG_CONFIG_PATH
  - ls -lta $VIRT_ROOT
  - ls -lta $MAIN_DIR
  - sh -c "if [ '$GSTREAMER' = '1.0'   ]; then sudo add-apt-repository -y ppa:ricotz/testing; fi"
  - sh -c "if [ '$GSTREAMER' = '1.0'   ]; then sudo add-apt-repository -y ppa:gnome3-team/gnome3; fi"
  - sh -c "if [ '$GSTREAMER' = '1.0'   ]; then sudo add-apt-repository -y ppa:gnome3-team/gnome3-staging; fi"
  - sudo apt-get update -qq
  - sudo apt-get install -y libz-dev libbz2-dev gstreamer$GSTREAMER-tools libgstreamer$GSTREAMER-dev libgstreamer-plugins-base$GSTREAMER-dev libgstreamer-plugins-bad$GSTREAMER-dev
  - sh -c "if [ '$GSTREAMER' = '1.0'   ]; then sudo apt-get install -y libgstreamer-plugins-good$GSTREAMER-dev; fi"
  - "sudo apt-get update -qq"
  - "sudo apt-get install -y gir1.2-gst-plugins-base-1.0 gir1.2-gstreamer-1.0 graphviz-dev gstreamer1.0-plugins-good gstreamer1.0-plugins-bad python-gst-1.0"
  - "sudo apt-get install -qq python3-gi"
  - "sudo apt-get install -qq python-gst-1.0 gstreamer1.0-plugins-base gstreamer1.0-plugins-bad gstreamer1.0-plugins-good gstreamer1.0-plugins-ugly gstreamer1.0-libav libsndfile1-dev libasound2-dev libgstreamer-plugins-base1.0-dev python-numpy python-scipy"
  # source: https://github.com/ErinMorelli/em-media-handler/blob/6fbb1188ba6ebffa0b20cc1a255f37828325ee87/.travis.yml
  # DBUS fixes for ABC
  # - sudo apt-get install -y dbus* -qq
  # - export DISPLAY=:0
  # - eval $(dbus-launch --sh-syntax)
  # - export DBUS_SESSION_BUS_ADDRESS
  # - export DBUS_SESSION_BUS_PID
  - sudo apt-get -y install automake gir1.2-gst-plugins-base-1.0 gir1.2-gstreamer-1.0 gstreamer1.0-libav gstreamer1.0-plugins-bad gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-ugly gstreamer1.0-tools libasound2-dev libgstreamer-plugins-base1.0-dev libsndfile1-dev python python-dev python-gi python-gst-1.0 python-gst-1.0 python-imaging python-lxml python-numpy python-scipy python-virtualenv python3-gi
  - sudo apt-get -y install libsdl2-dev libsdl2-ttf-dev libsdl2-image-dev libsdl2-mixer-dev gnome-common;
  - sudo apt-get -y install libgstreamer1.0-dev gstreamer1.0-alsa gstreamer1.0-plugins-base;
  - sudo apt-get -y install python-dev libsmpeg-dev libswscale-dev libavformat-dev libavcodec-dev libjpeg-dev libtiff4-dev libX11-dev libmtdev-dev;
  - sudo apt-get -y install python-setuptools build-essential libgl1-mesa-dev libgles2-mesa-dev;
  - sudo apt-get -y install xvfb pulseaudio;

  #
  # - export PYGI_LOCATION=$(dpkg-query -L python3-gi | grep "packages/gi$")
  # - echo $PYTHON_VERSION
  # - echo $PYTHON_INC_DIR
  # - echo $PYTHON_SITE_PACKAGES
  # - echo $PYGI_LOCATION
  # - ln -s $PYGI_LOCATION "${PYTHON_SITE_PACKAGES}/gi"
  # - file ${PYTHON_SITE_PACKAGES}/gi
  # - ls -lta ${PYTHON_SITE_PACKAGES}
  # - ls -lta ${PYTHON_SITE_PACKAGES}/gi

deploy:
  distributions: sdist bdist_wheel
  provider: pypi
  user: bossjones
  password:
    secure: !!binary |
      UlR3T0FKekJlRVh5MWFzK2Ezc3V0Y1NqTlRmb1NnMTVlcDh0SElqT3FLMGV0a1RoV1hORnMwRnZX
      TnVDaFYzenNGaEE0MHNNcEFhbUh2Y0dYSjcxN0dBWUlQc3RJcmdBdXNMS003T0lVWHBVRjZrcXZa
      c1JRdzlSUFM0dkJtdWVCb0JvK3BMWTZxOWdJUCtCYXYrZkZ3V29jU3lqd0hMR2NhT1ZkT0YvbTJW
      YldFZzNwK1NHd1ZvbGd1U3BXQk5vYkxEbXdqOHlkL3FpWjZiMkx2VHJPVmtVRU5mYThaazhCU1hl
      clppVGU5OEkyYy9LdUdxa1ZpcmQrM0x1bEswa0RVMUZFTk85djVlaCt3WnpFbGdiVlNHZnk4N2dr
      ZGM1d2hZSXo0b0E3OTRHYzBqdCtZaVAyazBwTlBSR0FjckFuNU1SakNkdldRdG1rYnhkbnMvSlpP
      ZUs1OVNyaGNRNkJSZkROUUM5N01QRVpBei9FM3FoaURQeHdiaHVLK0xzZElpUkhuYXp3djRNdVVV
      MjdUY3F3dFRXY1lpanpUMGFpZmlRVVc2aEx3cG1WTXg2R0p5OGR2aGgrVXJzcjUyamFBYUZWeDMx
      TlVCOTYrV2EyMDRMQ1pWMUNGbzh2S2dxRHhUalpCZkVLMHplcFFVaDA2ZFJkTUphZUFOL2Roc3Vw
      TWpuRWZWWTVHU3YreVNLa0pKMnI3N21uZ3lWTzNzbk1zNngyc2RIK1BqZk1uT0VtUVVjcG5hTkNR
      RjAxUnh4ZlV6KzdUWTBKb25NNHliN2RuYytUNDAyRytQaEVES0dpNS9PMVlDSUh3V1FjTXhodjJy
      TWlZU2xVdDNpa2N4a1c4WUdoaFJ2RVVYMXJHeUF0UFdCYW55SitLTWIzUVd2N2h1S0U3RXpjL0U9
  true:
    condition: $TOXENV == py27
    repo: bossjones/scarlett_os
    tags: true
# env:
# - TOXENV=py35
# - TOXENV=pypy
# install: pip install -U tox
# language: python
# python: 3.5
# script: tox -e ${TOXENV}

# sudo: false
matrix:
  fast_finish: true
  include:
    - python: "3.5_with_system_site_packages"
      env: TOXENV=typing
    - python: "3.5_with_system_site_packages"
      env: TOXENV=py35
    - python: "pypy"
      env: TOXENV=pypy
  allow_failures:
    - python: "3.5_with_system_site_packages"
      env: TOXENV=typing
cache:
  directories:
    - $HOME/.cache/pip
    - $HOME/virtualenv/python3.5.0/lib/python3.5_with_system_site_packages/site-packages
install:
  - export MAIN_DIR=$(pwd)
  - export VIRT_ROOT=/home/travis/virtualenv/python$TRAVIS_PYTHON_VERSION
  - export PKG_CONFIG_PATH=$VIRT_ROOT/lib/pkgconfig
  - export SCARLETT_CONFIG=$MAIN_DIR/tests/fixtures/.scarlett
  # - export SCARLETT_HMM=$MAIN_DIR/tests/fixtures/model/hmm/en_US/hub4wsj_sc_8k
  - export SCARLETT_LM=$MAIN_DIR/tests/fixtures/lm/1602.lm
  - export SCARLETT_DICT=$MAIN_DIR/tests/fixtures/dict/1602.dic
  - export PYTHONIOENCODING=UTF8
  - export GSTREAMER=1.0
  - export PYTHON_VERSION=$(python -c "import sys; print('%s.%s' % sys.version_info[:2])")
  - export PYTHON_INC_DIR=$(python -c "from distutils.sysconfig import get_python_inc; print(get_python_inc())")
  - export PYTHON_SITE_PACKAGES=$(python -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")
  - ls -lta $PKG_CONFIG_PATH
  - ls -lta $VIRT_ROOT
  - ls -lta $MAIN_DIR
  - pip install -U tox coveralls
  - export PYGI_LOCATION=$(dpkg-query -L python3-gi | grep "packages/gi$")
  - echo $PYTHON_VERSION
  - echo $PYTHON_INC_DIR
  - echo $PYTHON_SITE_PACKAGES
  - echo $PYGI_LOCATION
  - ln -s $PYGI_LOCATION "${PYTHON_SITE_PACKAGES}/gi"
  - file ${PYTHON_SITE_PACKAGES}/gi
  - ls -lta ${PYTHON_SITE_PACKAGES}
  - ls -lta ${PYTHON_SITE_PACKAGES}/gi
script: tox -e ${TOXENV}
after_success: coveralls
